<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Steal a Brainrot — Store</title>
<style>
  :root{--bg:#0b1117;--panel:#0c1219;--card:#0f1720;--text:#e6f0ff;--muted:#a7b3c4;--brand:#06b6d4;--brand2:#22d3ee;--ring:rgba(34,211,238,.35)}
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:#0b1117;color:var(--text)}
  .wrap{max-width:1100px;margin:0 auto;padding:28px}
  header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
  .hero{background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.015));border:1px solid rgba(148,163,184,.18);border-radius:18px;padding:18px}
  .grid{display:grid;grid-template-columns:1fr;gap:18px;margin-top:18px}
  @media (min-width:920px){.grid{grid-template-columns:1fr 360px}}
  .card{background:var(--card);border:1px solid rgba(148,163,184,.18);border-radius:16px;overflow:hidden;display:flex;flex-direction:column}
  .media{display:grid;place-items:center;background:#0d1420;padding:16px}
  .media img{width:100%;height:260px;object-fit:contain;filter:drop-shadow(0 16px 40px rgba(2,8,23,.8))}
  .body{padding:16px}
  .h2{margin:0 0 4px;font-size:20px}
  .muted{color:var(--muted)}
  .row{display:flex;align-items:center;justify-content:space-between;margin-top:8px}
  .price{font-weight:800;background:linear-gradient(90deg,var(--brand2),#60a5fa);-webkit-background-clip:text;background-clip:text;color:transparent}
  .btn{padding:10px 14px;border-radius:12px;border:1px solid rgba(148,163,184,.25);background:rgba(2,8,23,.5);color:var(--text);cursor:pointer}
  .btn-primary{border:none;background:linear-gradient(180deg,var(--brand),var(--brand2));color:#061014}
  .panel{background:var(--panel);border:1px solid rgba(148,163,184,.22);border-radius:16px;padding:16px;display:grid;gap:10px;position:sticky;top:18px}
  label{font-size:14px;color:var(--muted)}
  input,select{width:100%;padding:10px 12px;border-radius:10px;border:1px solid rgba(148,163,184,.25);background:rgba(2,8,23,.5);color:var(--text);outline:none}
  input:focus,select:focus{border-color:var(--brand2);box-shadow:0 0 0 6px var(--ring)}
  .line{display:flex;justify-content:space-between}
  .summary{color:var(--muted)}
  ul.items{margin:8px 0 0 18px; padding:0}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1 style="margin:0">Steal a Brainrot — Store</h1>
      <small class="summary">Secure PayPal Checkout</small>
    </header>

    <section class="hero">
      <strong>Promo:</strong> Use code <code>Secret000</code> to get <strong>Los Tralaleritos（500K/s）</strong> for free.
    </section>

    <section class="grid">
      <!-- Products list -->
      <div class="list" id="list"></div>

      <!-- Cart / Checkout -->
      <aside class="panel">
        <h3 style="margin:0">Checkout</h3>
        <label>Roblox username</label>
        <input id="username" placeholder="your exact Roblox username" autocomplete="nickname" />

        <label>Email for updates</label>
        <input id="email" type="email" placeholder="you@example.com" autocomplete="email" />

        <div class="line" style="gap:12px">
          <div style="flex:1">
            <label>Currency</label>
            <select id="currency"><option value="EUR">EUR (€)</option><option value="USD">USD ($)</option></select>
          </div>
          <div style="flex:1">
            <label>Promo code</label>
            <input id="coupon" placeholder="Secret000" />
          </div>
        </div>

        <div class="summary" id="summary">Cart empty</div>
        <div id="paypal-button-container"></div>
        <small class="summary">We don’t store card data. Payments are completed on PayPal.</small>
      </aside>
    </section>
  </div>

  <footer class="summary" style="max-width:1100px;margin:18px auto;padding:0 28px 28px">© <span id="year"></span> Steal a Brainrot</footer>

  <!-- Load PayPal SDK via server (injects client-id) -->
  <script src="/api/sdk.js"></script>

  <script>
    const PRODUCTS = [
      {
        sku:'tralalita-100kps',
        name:'Tralalita tralala（100K/s）',
        img:'https://www.lolga.com/uploads/images/goods/steal-a-brainrot/all-server-tralalita-tralala.png?v=1',
        EUR:3, USD:3
      },
      {
        sku:'los-hotspotsitos-20mps',
        name:'Los Hotspotsitos（20M/s）',
        img:'https://www.lolga.com/uploads/images/goods/steal-a-brainrot/all-server-los-hotspotsitos.png',
        EUR:6, USD:6   // ← change price easily
      },
      {
        sku:'los-tralaleritos-500kps',
        name:'Los Tralaleritos（500K/s）',
        img:'https://www.lolga.com/uploads/images/goods/steal-a-brainrot/all-server-los-tralaleritos.png?v=1',
        EUR:3, USD:3   // free with coupon Secret000
      }
    ];

    const list = document.getElementById('list');
    const cart = [];
    const currencyEl = document.getElementById('currency');
    const usernameEl = document.getElementById('username');
    const emailEl = document.getElementById('email');
    const couponEl = document.getElementById('coupon');
    const summaryEl = document.getElementById('summary');
    document.getElementById('year').textContent = new Date().getFullYear();

    // Render products
    list.innerHTML = PRODUCTS.map(p => `
      <article class="card" data-sku="${p.sku}">
        <div class="media"><img src="${p.img}" alt="${p.name}" loading="lazy"></div>
        <div class="body">
          <h2 class="h2">${p.name}</h2>
          <p class="muted">Instant delivery • All servers</p>
          <div class="row">
            <span class="price">€${p.EUR} / $${p.USD}</span>
            <button class="btn btn-primary" onclick="addToCart('${p.sku}')">Buy now!</button>
          </div>
        </div>
      </article>
    `).join('');

    function addToCart(sku){
      const p = PRODUCTS.find(x=>x.sku===sku);
      const ex = cart.find(x=>x.sku===sku);
      if(ex) ex.qty += 1; else cart.push({ sku:p.sku, name:p.name, EUR:p.EUR, USD:p.USD, qty:1 });
      renderSummary();
    }

    function totals(ccy, coupon){
      let total = 0;
      const lines = cart.map(i => {
        const unit = ccy==='EUR'?i.EUR:i.USD;
        let line = unit * i.qty;
        // Coupon: Secret000 makes Los Tralaleritos free
        if(coupon && coupon.trim().toLowerCase() === 'secret000' && i.sku === 'los-tralaleritos-500kps') {
          line = 0;
        }
        total += line;
        return { ...i, unit, line };
      });
      return { lines, total };
    }

    function renderSummary(){
      if(!cart.length){ summaryEl.textContent = 'Cart empty'; return; }
      const { lines, total } = totals(currencyEl.value, couponEl.value);
      const c = currencyEl.value==='EUR'?'€':'$';
      summaryEl.innerHTML = `
        <ul class="items">${lines.map(l => `<li>${l.name} ×${l.qty} — ${c}${l.line}</li>`).join('')}</ul>
        <div style="margin-top:6px"><strong>Total ${c}${total}</strong></div>
      `;
    }

    currencyEl.addEventListener('change', renderSummary);
    couponEl.addEventListener('input', renderSummary);

    // PayPal buttons init (called by /api/sdk.js)
    window.initPayPalButtons = function(){
      paypal.Buttons({
        style: { layout:'vertical', shape:'pill' },

        createOrder: async () => {
          if(!cart.length) return alert('Add an item first.') || false;
          const username = usernameEl.value.trim();
          const email = emailEl.value.trim();
          if(!username) return alert('Enter your Roblox username.') || false;
          if(!/^\S+@\S+\.\S+$/.test(email)) return alert('Enter a valid email.') || false;

          const res = await fetch('/api/paypal/create-order', {
            method: 'POST',
            headers: { 'Content-Type':'application/json' },
            body: JSON.stringify({
              currency: currencyEl.value,
              coupon: couponEl.value.trim(),
              items: cart,
              meta: { username, email }
            })
          });
          const data = await res.json();

          // Free order (total = 0) returns {free:true, orderId: "..."} and we skip PayPal UI.
          if(data.free){
            alert('Order placed for €0 — promo applied! We will deliver shortly.');
            cart.length = 0; renderSummary();
            return false; // prevent PayPal popup
          }

          if(!res.ok){ alert(data.error || 'Failed to create order'); return false; }
          return data.id;
        },

        onApprove: async (data) => {
          const res = await fetch('/api/paypal/capture-order', {
            method: 'POST',
            headers: { 'Content-Type':'application/json' },
            body: JSON.stringify({ orderId: data.orderID })
          });
          const out = await res.json();
          if(!res.ok){ alert(out.error || 'Capture failed'); return; }
          alert('Payment successful! We will deliver shortly.');
          cart.length = 0; renderSummary();
        },

        onError: (err) => {
          console.error(err);
          alert('Payment error. Please try again.');
        }
      }).render('#paypal-button-container');
    };
  </script>
</body>
</html>
