<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Clipscribe AI — Auto Subtitles for Shorts</title>
  <link rel="icon" href="data:," />
  <style>
    :root {
      --bg: #0b0b0d;
      --panel: #121216;
      --text: #e8e8f0;
      --muted: #9aa0aa;
      --brand: #8a7bff;
      --brand2: #20e3b2;
    }
    * { box-sizing: border-box; margin:0; padding:0; }
    body {
      background: radial-gradient(1200px 600px at 70% -20%, #181a21 0%, #0b0b0d 60%);
      color: var(--text);
      font: 16px/1.5 Inter, system-ui, sans-serif;
    }

    header {
      display: flex; justify-content: space-between; align-items: center;
      padding: 20px 32px; backdrop-filter: blur(10px);
    }
    .brand { font-weight: 800; font-size: 20px; display: flex; gap: 8px; align-items:center; }
    .brand span { width: 12px; height: 12px; border-radius: 50%; background: conic-gradient(from 0deg,var(--brand),var(--brand2),var(--brand)); }
    .btn {
      padding: 10px 18px; border-radius: 12px; text-decoration: none;
      background: var(--brand); color:#fff; font-weight:600; border:none; cursor:pointer;
    }

    .hero { text-align:center; padding:80px 20px 40px; }
    .hero h1 { font-size:48px; line-height:1.1; }
    .hero p { margin-top:12px; color:var(--muted); }
    .cta { margin-top:20px; }

    .wrap { width:min(1100px,100%); margin:40px auto; display:grid; grid-template-columns:360px 1fr; gap:20px; padding:0 20px; }
    .card { background:linear-gradient(180deg,rgba(255,255,255,.05),rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.06); border-radius:16px; padding:16px; }

    .controls label { display:block; font-size:14px; margin:10px 0 6px; color:var(--muted); }
    .controls input[type=file], .controls select, .controls button {
      width:100%; border-radius:12px; padding:10px 12px;
      border:1px solid rgba(255,255,255,.08); background:var(--panel); color:var(--text);
    }
    .controls button { margin-top:10px; cursor:pointer; font-weight:600; }
    .controls .actions { display:flex; gap:10px; margin-top:12px; }

    .player { position:relative; aspect-ratio:9/16; background:#000; border-radius:16px; overflow:hidden; }
    video { width:100%; height:100%; object-fit:contain; }
    .captions { position:absolute; inset:0; display:flex; justify-content:center; align-items:flex-end; padding-bottom:8%; text-align:center; }
    .caption-line {
      font-family: KomikaAxis, Impact, 'Arial Black', sans-serif;
      font-size:32px; font-weight:800; color:#fff;
      text-shadow:0 2px 0 #000,2px 0 0 #000,-2px 0 0 #000,0 -2px 0 #000,0 0 8px #000;
    }
    .caption-line .em { color:#ffe46b; }
    pre { font-size:12px; white-space:pre-wrap; color:var(--muted); margin-top:10px; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/@xenova/transformers@2.15.0/dist/transformers.min.js"></script>
</head>
<body>
  <header>
    <div class="brand"><span></span>Clipscribe AI</div>
    <a href="#app" class="btn">Start now</a>
  </header>

  <section class="hero">
    <h1>1 video → Perfect Captions</h1>
    <p>Generate bold Komika Axis subtitles for TikToks/Shorts. On-device, private, and free.</p>
    <div class="cta"><a href="#app" class="btn">Start now</a></div>
  </section>

  <main id="app" class="wrap">
    <div class="card controls">
      <label>Upload video</label>
      <input id="file" type="file" accept="video/*" />
      <label>Words per subtitle</label>
      <select id="wordsPer"><option value="1">1</option><option value="3" selected>3</option></select>
      <label>Emphasize every</label>
      <select id="emEvery"><option value="0">None</option><option value="3">3rd</option><option value="5">5th</option></select>
      <div class="actions">
        <button id="go">Generate</button>
        <button id="downloadVTT" disabled>Download .vtt</button>
      </div>
      <pre id="log"></pre>
    </div>
    <div class="card">
      <div class="player">
        <video id="video" controls></video>
        <div class="captions"><div class="caption-line" id="caption"></div></div>
      </div>
    </div>
  </main>

<script>
const logEl=document.getElementById('log');const videoEl=document.getElementById('video');const captionEl=document.getElementById('caption');
const fileEl=document.getElementById('file');const wordsPerEl=document.getElementById('wordsPer');const emEveryEl=document.getElementById('emEvery');
const goBtn=document.getElementById('go');const dlBtn=document.getElementById('downloadVTT');let cues=[];let lastURL;

function log(m){logEl.textContent+=`\\n${m}`;}

fileEl.onchange=()=>{const f=fileEl.files?.[0];if(!f)return;if(lastURL)URL.revokeObjectURL(lastURL);lastURL=URL.createObjectURL(f);videoEl.src=lastURL;log('Ready.');};

async function decodeToMono16k(file){const ab=await file.arrayBuffer();const ctx=new AudioContext();const buf=await ctx.decodeAudioData(ab.slice(0));
const off=new OfflineAudioContext(1,Math.ceil(buf.duration*16000),16000);const mono=off.createBuffer(1,buf.length,buf.sampleRate);const ch0=buf.getChannelData(0);
if(buf.numberOfChannels===1)mono.copyToChannel(ch0,0);else{const ch1=buf.getChannelData(1),m=mono.getChannelData(0);for(let i=0;i<buf.length;i++)m[i]=.5*(ch0[i]+ch1[i]);}
const src=off.createBufferSource();src.buffer=mono;src.connect(off.destination);src.start();const rendered=await off.startRendering();return rendered.getChannelData(0);}

function groupWords(words,n){const g=[];for(let i=0;i<words.length;i+=n){const s=words.slice(i,i+n);g.push({text:s.map(w=>w.word).join(' '),start:s[0].start,end:s[s.length-1].end})}return g;}

function attachOverlay(groups,every){cues=groups;videoEl.ontimeupdate=()=>{const t=videoEl.currentTime;const c=cues.find(x=>t>=x.start&&t<=x.end);
if(!c){captionEl.innerHTML='';return;}if(every>0){captionEl.innerHTML=c.text.split(/\\s+/).map((w,i)=>((i+1)%every===0?`<span class='em'>${w}</span>`:w)).join(' ');}else captionEl.textContent=c.text;}};

let asr;async function ensure(){if(asr)return asr;const {pipeline}=window.transformers;asr=await pipeline('automatic-speech-recognition','Xenova/whisper-tiny.en');return asr;}

async function generate(){const f=fileEl.files?.[0];if(!f){alert('Pick a video');return;}goBtn.disabled=true;dlBtn.disabled=true;captionEl.textContent='';log('Decoding...');const audio=await decodeToMono16k(f);
log('Transcribing...');const model=await ensure();const out=await model(audio,{chunk_length_s:25,stride_length_s:5,return_timestamps:true});const words=[];(out.segments||[]).forEach(s=>(s.words||[]).forEach(w=>{if(w.start!==undefined)words.push({word:w.word.trim(),start:w.start,end:w.end})}));
const groups=groupWords(words,parseInt(wordsPerEl.value));attachOverlay(groups,parseInt(emEveryEl.value));const vtt='WEBVTT\\n\\n'+groups.map((g,i)=>`${i+1}\\n00:00:${g.start.toFixed(3)} --> 00:00:${g.end.toFixed(3)}\\n${g.text}\\n`).join('\\n');const blob=new Blob([vtt],{type:'text/vtt'});const url=URL.createObjectURL(blob);
dlBtn.disabled=false;dlBtn.onclick=()=>{const a=document.createElement('a');a.href=url;a.download='captions.vtt';a.click();};log('✅ Done!');goBtn.disabled=false;}

goBtn.onclick=()=>generate();
</script>
</body>
</html>
